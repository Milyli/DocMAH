var DMH=DMH||{};DMH.HistoryState=function(){return this.Replace=1,this.Push=2,this.Pop=3,this}();DMH.Urls=function(){return this.DeletePage="/help.axd?m=DeletePage",this.GenerateInstallScript="/help.axd?m=GenerateInstallScript",this.MovePage="/help.axd?m=MovePage",this.NavigateDocumentation="/help.axd?m=DocumentationPage",this.ReadApplicationSettings="/help.axd?m=ReadApplicationSettings",this.ReadPage="/help.axd?m=ReadPage",this.ReadTableOfContents="/help.axd?m=ReadTableOfContents",this.SaveDocumentationPage="/help.axd?m=SaveDocumentationPage",this.SaveFirstTimeHelp="/help.axd?m=SaveFirstTimeHelp",this.SaveUserPageSettings="/help.axd?m=SaveUserPageSettings",this}();DMH.Helpers=function(){return this.GetQueryParameter=function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))},this}();DMH.AjaxClient=function(){this.DeletePage=function(n,t){$.ajax({type:"POST",url:DMH.Urls.DeletePage,data:n.toString(),success:t})};this.MovePage=function(n,t,i){$.ajax({type:"POST",url:DMH.Urls.MovePage,data:JSON.stringify({PageId:n,NewParentId:t,NewPosition:i}),async:!1})};this.ReadApplicationSettings=function(n){$.ajax({type:"GET",url:DMH.Urls.ReadApplicationSettings,success:n,async:!1})};this.ReadPage=function(n,t){$.ajax({type:"GET",data:{id:n},url:DMH.Urls.ReadPage,success:t})};this.ReadTableOfContents=function(n){$.ajax({type:"GET",url:DMH.Urls.ReadTableOfContents,success:n})};this.SaveDocumentationPage=function(n,t){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:DMH.Urls.SaveDocumentationPage,data:JSON.stringify(n),success:t})};this.SaveFirstTimeHelp=function(n,t){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:DMH.Urls.SaveFirstTimeHelp,data:JSON.stringify(n),success:t})};this.SaveUserPageSettings=function(n){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:DMH.Urls.SaveUserPageSettings,data:JSON.stringify(n)})}};DMH.AnchoredElementLogic=function(){var t=new DMH.SharedElements,n=this;this.UpdateElementPosition=function(n,t){if(t.length>0){var r=$("#"+n.OffsetElementId).offset(),u=r?r.top+n.VerticalOffset:0,i=r?r.left+n.HorizontalOffset:0;i<0?i=0:i+t.width()>$(document).width()&&(i=$(document).width()-t.width());t.css({top:u,left:i})}};this.UpdateElementPositions=function(i,r){t.$getModalMask().is(":visible")&&($.each(i.Bullets,function(t,i){n.UpdateElementPosition(i,$("#dmhDraggableBullet-"+i.Number));n.UpdateElementPosition(i,$("#dmhPlacedBullet-"+i.Number))}),r.is(":visible")&&n.UpdateElementPosition(i,r))}};DMH.Cookies=function(){this.DeleteCookie=function(n){document.cookie=n+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"};this.GetCookie=function(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return""};this.SetCookie=function(n,t,i){var r=new Date,u=n+"="+t,f;i&&(r.setTime(r.getTime()+i*864e5),f="expires="+r.toUTCString(),u=u+"; "+f);document.cookie=u}};DMH.DocumentationPage=function(){function tt(){return $("#dmhCancelButton")}function it(){return $("#dmhDocContentPanel")}function o(){return $("#dmhDocumentationEditor")}function y(){return $("#dmhDocumentationEditorContent")}function p(){return $("#dmhDocumentationEditorTitle")}function w(){return $("#dmhDocumentationTools")}function s(){return $("#dmhDocumentationView")}function rt(){return $("#dmhDocumentationViewContent")}function ut(){return $("#dmhDocumentationViewTitle")}function h(){return $("#dmhEditButton")}function b(){return $("#dmhEditModeButtonBar")}function ft(){return $("#dmhGenerateInstallScriptButton")}function c(){return $("#dmhIsHidden")}function et(){return $("#dmhNewPageButton")}function ot(){return $("#dmhPage")}function st(){return $("#dmhPageContainer")}function ht(){return $("#dmhSaveButton")}function t(){return $("#dmhToc")}function ct(){return $("#dmhDocTitle")}function k(){return $("#dmhDocToolBar")}function d(){return $("#dmhViewModeButtonBar")}function l(t,r){var u,o;r=r||DMH.HistoryState.Push;u=f(t.id);u&&(!n||n.Id!==u)&&(o=new DMH.AjaxClient,o.ReadPage(u,function(n){var u="help.axd?m=DocumentationPage&id="+n.Id;r===DMH.HistoryState.Replace?(n.HistoryId=i,history.replaceState(n,n.Title,u)):r===DMH.HistoryState.Push?(n.HistoryId=++i,history.pushState(n,n.Title,u)):r===DMH.HistoryState.Pop&&(n.HistoryId=i);nt(t);e(n)}))}function f(n){return n==="#"?null:parseInt(n.substring(12))}function g(){if(r&&r.CanEdit){var t=k().outerWidth(!0);it().css({left:t+"px"});ct().css({left:t+"px"});k().show();w().hide();b().hide();h().hide();d().show();n&&(h().show(),c().prop("disabled",!0).prop("checked",n.IsHidden),w().show())}}function a(){if(n){var t=st(),i=ot(),r=t.get(0).clientHeight,u=t.get(0).clientWidth;i.width(u).height(r)}}function lt(){if(n){var i=new DMH.AjaxClient;i.SaveDocumentationPage(n,function(){var i=t().jstree("get_node","dmhTocEntry-"+n.Id);t().jstree("rename_node",i,n.Title);n.IsHidden?(i.li_attr["class"]="tocHidden",$("#"+i.id).addClass("tocHidden")):(i.li_attr["class"]="",$("#"+i.id).removeClass("tocHidden"));e(n);$("#dmhStatusMessage").html("Page saved.").css("background-color","#2d9639").show().delay(1e3).fadeOut("slow")})}}function nt(n){var i=t().jstree(),r=i.get_selected(!0);i.deselect_node(r);i.select_node(n)}function e(t){n=t;v=$.extend(!0,{},t);s().hide();o().hide();t&&(ut().html(n.Title),rt().html(n.Content),s().show(),o().hide());g();a()}function at(){$("#dmhStatusMessage").html("Changes canceled.").css("background-color","#3c454f").show().delay(1e3).fadeOut("slow");e(v)}function vt(){d().hide();b().show();c().prop("disabled",!1);p().val(n.Title);y().val(n.Content);s().hide();o().show()}function yt(){window.open(DMH.Urls.GenerateInstallScript)}function pt(){var n=t().jstree();n.create_node("#",{text:"New Page"},"last",function(t){setTimeout(function(){n.edit(t)},0)})}function wt(n){var i,u,e;if($.each(n,function(n,i){var r='<li id="dmhTocEntry-'+i.Id+'" class="dmhTocEntry'+(i.IsHidden?" tocHidden":"")+'">';r+=i.Title;r+="<ul><\/ul><\/li>";i.ParentPageId?$("#dmhTocEntry-"+i.ParentPageId+">ul").append(r):t().find(">ul").append(r)}),i=["wholerow","state"],u={core:{check_callback:!0,multiple:!1,themes:{icons:!1}},plugins:i},r.CanEdit&&(i.push("contextmenu"),i.push("dnd"),u.contextmenu={items:{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"New Page",action:function(n){var t=$.jstree.reference(n.reference),i=t.get_node(n.reference);t.create_node(i,{text:"New Page"},"last",function(n){setTimeout(function(){t.edit(n)},0)})}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete Page",action:function(n){var i=$.jstree.reference(n.reference),t=i.get_node(n.reference),r,u;$.each(t.children,function(n,r){i.move_node(r,t.parent,"last")});i.delete_node(t);r=f(t.id);u=new DMH.AjaxClient;u.DeletePage(r)}}}}),e=t().jstree(u).on("activate_node.jstree",kt).on("ready.jstree",ii),r.CanEdit)e.on("create_node.jstree",dt).on("delete_node.jstree",gt).on("move_node.jstree",ni).on("rename_node.jstree",ti)}function bt(){n.IsHidden=c().prop("checked");n.Title=p().val();n.Content=y().val();lt()}function kt(n,t){l(t.node)}function dt(n,t){var i={ParentPageId:f(t.parent),Order:t.position,Title:"New Page",Content:""},r=new DMH.AjaxClient;r.SaveDocumentationPage(i,function(n){t.instance.set_id(t.node,"dmhTocEntry-"+n.Id);u=n})}function gt(n,t){var r=null,u,i;t.node.parent==="#"?(u=$(".dmhTocEntry"),u.length>0&&(i=u.get(0).id,i===t.node.id&&(i=null,u.length>1&&(i=u.get(1).id)),i&&(r=t.instance.get_node(i)))):t.node.parent&&(r=t.instance.get_node(t.node.parent));r?(t.instance.select_node(r),l(r,DMH.HistoryState.Replace)):e(null)}function ni(t,i){var r=f(i.node.id),u=f(i.parent),e=new DMH.AjaxClient;e.MovePage(r,u,i.position);n.Id===r&&(n.ParentPageId=u,n.Order=i.position)}function ti(n,t){if(u){u.Title=t.text;var i=new DMH.AjaxClient;i.SaveDocumentationPage(u);u=null}}function ii(n,i){var r=null,f=DMH.Helpers.GetQueryParameter("id"),u;f&&(r=t().jstree("get_node","dmhTocEntry-"+f));r||(u=i.instance.get_selected(!0),u&&u.length>0&&(r=u[0]));r&&l(r,DMH.HistoryState.Replace)}function ri(n){var r=n.state,f=r.HistoryId>i,u;f?i++:i--;u=t().jstree("get_node","dmhTocEntry-"+r.Id);u?(nt(u),e(r)):f?history.forward():history.back()}var r=null,n=null,u=null,v=null,i=1;this.Initialize=function(){var n=new DMH.AjaxClient;n.ReadApplicationSettings(function(n){r=n;g()});n.ReadTableOfContents(wt);ht().click(bt);tt().click(at);h().click(vt);ft().click(yt);et().click(pt);$(window).resize(a);window.onpopstate=ri;a()}};DMH.HelpButton=function(){function n(){return $(".dmhHelpButton")}function i(i){t=i;i?n().attr("Title","Show help for this page"):n().attr("Title","View documentation")}function u(){t?$(r).trigger("showFirstTime.dmh"):window.open(DMH.Urls.NavigateDocumentation,"_blank")}var r=this,t=null;this.Initialize=function(t,r){i(r);$(t).bind("pageUpdate.dmh",function(n,t){i(t)});n().click(u)}};DMH.FirstTimeEdit=function(){function ut(){return $("#dmhAddBulletButton")}function ft(n){return $(".dmhBulletEdit",n)}function p(){return $("#dmhBulletEditTemplate")}function w(n){return $(".dmhBulletEditText",n)}function et(){return $("#dmhCancelHelpButton")}function i(){return $("#dmhCreateHelpButton")}function e(){return $(".dmhDialogTitle")}function b(n){return $(">.dmhDraggableBullet",n)}function o(n){return $(".dmhDraggableBulletNumber",n)}function t(){return $("#dmhFirstTimeEdit")}function u(){return $("#dmhFirstTimeEditBullets")}function s(){return $("#dmhFirstTimeEditContent")}function h(){return $("#dmhFirstTimeEditMatchUrls")}function c(){return $("#dmhFirstTimeEditTitle")}function l(){return $("#dmhSaveHelpButton")}function k(n){var t=p().clone(!0,!0).attr("id","dmhBulletEdit-"+n.Number),i,r,f,e;t.find(".dmhBulletNumber").html(n.Number);n.Text&&w(t).val(n.Text);u().append(t);i=b(t);o(i).html(n.Number);i.detach();$("body").append(i);n.OffsetElementId?(e=$("#"+n.OffsetElementId).offset(),r=e.top+n.VerticalOffset,f=e.left+n.HorizontalOffset):(r=t.offset().top-3,f=t.offset().left-50);i.attr("id","dmhDraggableBullet-"+n.Number).css({top:r+"px",left:f+"px"}).draggable({containment:"document",stop:at});nt(i.get(0))}function d(){b("body").remove();t().hide();v.$getModalMask().hide();i().show()}function ot(){l().html("Create");e().html("Create Help Page");c().val("Help - "+document.title);h().val(window.location.pathname);s().val("");u().empty();var n=$(document).width()/3*2-t().width();t().css({top:"200px",left:n})}function st(n){l().html("Save");e().html("Edit Help Page");c().val(n.Title);h().val(n.MatchUrls);s().val(n.Content);u().empty();$.each(n.Bullets,function(n,t){k(t)});var i=$("#"+n.OffsetElementId),r=i.offset().top+n.VerticalOffset+"px",f=i.offset().left+n.HorizontalOffset+"px";t().css({top:r,left:f})}function g(n){var f=$(n),t=f.offset().left,e=t+f.width(),o=(e-t)/2+t,i=f.offset().top,s=i+f.height(),h=(s-i)/2+i,u=null;return r.each(function(n,r){var f=$(r),e=f.offset().left,l=e+f.width(),a=(l-e)/2+e,s=f.offset().top,v=s+f.height(),y=(v-s)/2+s,c=Math.sqrt(Math.pow(Math.abs(o-a),2)+Math.pow(Math.abs(h-y),2));u?c<u.Distance&&(u={Distance:c,HorizontalOffset:Math.round(t-e),VerticalOffset:Math.round(i-s),OffsetElementId:f.attr("id")}):u={Distance:c,HorizontalOffset:Math.round(t-e),VerticalOffset:Math.round(i-s),OffsetElementId:f.attr("id")}}),u}function nt(t){var r=g(t),u=parseInt(o($(t)).html()),i;$.each(n.Bullets,function(n,t){t.Number===u&&(i=t)});i.HorizontalOffset=r.HorizontalOffset;i.VerticalOffset=r.VerticalOffset;i.OffsetElementId=r.OffsetElementId}function tt(t){var i=g(t);n.HorizontalOffset=i.HorizontalOffset;n.VerticalOffset=i.VerticalOffset;n.OffsetElementId=i.OffsetElementId}function a(){var t=window.location.href,i=window.location.host,r=t.substring(t.indexOf(i)+i.length,t.length);n.Id=n.Id||0;n.Title=c().val();n.MatchUrls=h().val();n.SourceUrl=r;n.Content=s().val();$.each(n.Bullets,function(n,t){t.Text=w($("#dmhBulletEdit-"+(n+1))).val()})}function ht(){var t={Number:n.Bullets.length+1};n.Bullets.push(t);k(t)}function ct(){n=y;d()}function lt(){n&&(y=$.extend(!0,{},n));n?st(n):(n={Bullets:[]},ot());i().hide();v.$getModalMask().show();var r=t().show();tt(r.get(0))}function at(){nt(this);a()}function vt(){tt(this);a()}function yt(){var t=$(this).closest(".dmhBulletEdit"),i=t.find(".dmhBulletNumber").html();t.remove();$("#dmhDraggableBullet-"+i).remove();ft(u()).each(function(n,t){var i=n+1,r=$(t).find(".dmhBulletNumber"),f=r.html(),u;r.html(i);$(t).attr("id","dmhBulletEdit-"+i);u=$("#dmhDraggableBullet-"+f).attr("id","dmhDraggableBullet-"+i);o(u).html(i)});n.Bullets.splice(i-1,1);$.each(n.Bullets,function(n,t){t.Number=n+1})}function pt(){a();var t=new DMH.AjaxClient;t.SaveFirstTimeHelp(n,function(t){n.Id=t.Id});i().html("Edit Help Page");d();$(rt).trigger("pageUpdate.dmh",n)}function wt(){it.UpdateElementPositions(n,t())}var it=new DMH.AnchoredElementLogic,f=null,n=null,v=new DMH.SharedElements,r=null,y=null,rt=this;this.Initialize=function(u,o){f=u;n=o;f&&f.CanEdit&&(l().click(pt),et().click(ct),ut().click(ht),p().find(".dmhButtonCancel").click(yt),t().draggable({handle:e(),containment:"document",stop:vt}),r=$("*[id]:visible:not(.dmh-,.dmh- *,link,meta,script,style,:has(*))"),r.length===0&&(r=$("*[id]:visible:not(.dmh-,.dmh- *,link,meta,script,style)")),r.length===0?i().html("Cannot Create Help").attr("title","Click for more information.").click(function(){alert("DocMAH was unable to find elements to anchor to. Please add IDs to elements you wish to place help near.")}):(n&&i().html("Edit Help Page"),i().click(lt)));$(window).resize(wt)}};DMH.FirstTimeView=function(){function a(n){return $(".dmhBulletNumber",n)}function v(){return $("#dmhBulletViewTemplate")}function y(n){return $(".dmhBulletViewText",n)}function p(){return $("#dmhCloseHelpButton")}function w(){return $(".dmhDialogTitle")}function b(){return $("#dmhHideHelpButton")}function k(n){return $(".dmhPlacedBulletNumber",n)}function e(n){return $(">.dmhPlacedBullet",n)}function r(){return $("#dmhFirstTimeView")}function o(){return $("#dmhFirstTimeViewBullets")}function d(){return $("#dmhFirstTimeViewContent")}function g(){return $("#dmhShowDocumentationButton")}function nt(i){null===t?t={PageId:n.Id,HidePage:i}:t.HidePage=i;var r=new DMH.AjaxClient;r.SaveUserPageSettings(t)}function tt(n){var u=$("body"),i=$("#"+n.OffsetElementId).offset(),s=i?i.top+n.VerticalOffset:0,h=i?i.left+n.HorizontalOffset:f,r=v().clone(!0,!0).attr("id","dmhBulletView-"+n.Number),t;a(r).html(n.Number);y(r).html(n.Text);o().append(r);t=e(r);k(t).html(n.Number);t.detach();u.append(t);t.attr("id","dmhPlacedBullet-"+n.Number).css({top:s,left:h})}function s(){e($("body")).remove()}function h(n){n.data.model.ClosePage();var t=new DMH.Cookies;t.SetCookie("DMH-HideHelp",n.data.hide.toString(),730);nt(n.data.hide)}function it(){u.UpdateElementPositions(n,r());i.$getModalMask().height($(document).height()).width($(document).width())}var u=new DMH.AnchoredElementLogic,c=null,n=null,i=new DMH.SharedElements,l=this,t=null,f=0;this.ClosePage=function(){s();r().hide();$(document).off("resize");i.$getModalMask().hide()};this.Initialize=function(t,i,r){c=t;p().click({model:this,hide:!1},h);b().click({model:this,hide:!0},h);g().show().click(function(){window.open(DMH.Urls.NavigateDocumentation,"_blank")});$(window).resize(it);$(i).bind("pageUpdate.dmh",function(t,i){n=i});$(r).bind("showFirstTime.dmh",function(){l.ShowPage()})};this.ShowPage=function(t){if(t&&(n=t),n){s();d().html(n.Content);w().html(n.Title);var e=r();u.UpdateElementPosition(n,e);i.$getModalMask().height($(document).height()).width($(document).width());f=0;o().empty();$.each(n.Bullets,function(n,t){tt(t)});i.$getModalMask().show();e.show()}};this.ShowPageFirstTime=function(i,r){t=r;n=i;var u=new DMH.Cookies;n&&u.GetCookie("DMH-HideHelp")!=="true"&&(t===null||!t.HidePage)&&this.ShowPage()}};DMH.SharedElements=function(){this.$getModalMask=function(){return $("#dmhModalMask")}};
//# sourceMappingURL=DocMAHJavaScript.min.js.map
