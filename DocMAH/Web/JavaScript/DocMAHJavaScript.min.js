var SH=SH||{};SH.PageTypes=function(){return this.PopupPage=1,this.DocumentationPage=2,this}();SH.HistoryState=function(){return this.Replace=1,this.Push=2,this.Pop=3,this}();SH.Urls=function(){return this.DeletePage="/help.axd?m=DeletePage",this.GenerateInstallScript="/help.axd?m=GenerateInstallScript",this.MovePage="/help.axd?m=MovePage",this.NavigateDocumentation="/help.axd?m=DocumentationPage",this.ReadApplicationSettings="/help.axd?m=ReadApplicationSettings",this.ReadPage="/help.axd?m=ReadPage",this.ReadTableOfContents="/help.axd?m=ReadTableOfContents",this.SavePage="/help.axd?m=SavePage",this.SaveUserPageSettings="/help.axd?m=SaveUserPageSettings",this}();SH.Helpers=function(){return this.GetQueryParameter=function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))},this}();SH.AjaxClient=function(){this.DeletePage=function(n,t){$.ajax({type:"POST",url:SH.Urls.DeletePage,data:n.toString(),success:t})};this.MovePage=function(n,t,i){$.ajax({type:"POST",url:SH.Urls.MovePage,data:JSON.stringify({PageId:n,NewParentId:t,NewPosition:i}),async:!1})};this.ReadApplicationSettings=function(n){$.ajax({type:"GET",url:SH.Urls.ReadApplicationSettings,success:n,async:!1})};this.ReadPage=function(n,t){$.ajax({type:"GET",data:{id:n},url:SH.Urls.ReadPage,success:t})};this.ReadTableOfContents=function(n){$.ajax({type:"GET",url:SH.Urls.ReadTableOfContents,success:n})};this.SavePage=function(n,t){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:SH.Urls.SavePage,data:JSON.stringify(n),success:t})};this.SaveUserPageSettings=function(n){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:SH.Urls.SaveUserPageSettings,data:JSON.stringify(n)})}};SH.AnchoredElementLogic=function(){var t=new SH.SharedElements,n=this;this.UpdateElementPosition=function(n,t){if(t.length>0){var r=$("#"+n.OffsetElementId).offset(),u=r?r.top+n.VerticalOffset:0,i=r?r.left+n.HorizontalOffset:0;i<0?i=0:i+t.width()>$(document).width()&&(i=$(document).width()-t.width());t.css({top:u,left:i})}};this.UpdateElementPositions=function(i,r){t.$getPopupMask().is(":visible")&&($.each(i.Bullets,function(t,i){n.UpdateElementPosition(i,$("#shDraggableBullet-"+i.Number));n.UpdateElementPosition(i,$("#shPlacedBullet-"+i.Number))}),r.is(":visible")&&n.UpdateElementPosition(i,r))}};SH.Cookies=function(){this.DeleteCookie=function(n){document.cookie=n+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"};this.GetCookie=function(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return""};this.SetCookie=function(n,t,i){var r=new Date,u=n+"="+t,f;i&&(r.setTime(r.getTime()+i*864e5),f="expires="+r.toUTCString(),u=u+"; "+f);document.cookie=u}};SH.DocumentationPage=function(){function ot(){return $("#shCancelButton")}function st(){return $("#shDocContentPanel")}function l(){return $("#shDocumentationEditor")}function k(){return $("#shDocumentationEditorContent")}function d(){return $("#shDocumentationEditorTitle")}function g(){return $("#shDocumentationTools")}function a(){return $("#shDocumentationView")}function ht(){return $("#shDocumentationViewContent")}function ct(){return $("#shDocumentationViewTitle")}function v(){return $("#shEditButton")}function nt(){return $("#shEditModeButtonBar")}function lt(){return $("#shGenerateInstallScriptButton")}function y(){return $("#shIsHidden")}function at(){return $("#shNewPageButton")}function vt(){return $("#shPage")}function p(){return $("#shPageContainer")}function s(){return $("#shPopupImage")}function h(){return $("#shPopupImageUrl")}function tt(){return $("#shPopupTools")}function yt(){return $("#shSaveButton")}function t(){return $("#shToc")}function pt(){return $("#shDocTitle")}function it(){return $("#shDocToolBar")}function rt(){return $("#shViewModeButtonBar")}function w(t,i){var u,f;i=i||SH.HistoryState.Push;u=e(t.id);u&&(!n||n.Id!==u)&&(f=new SH.AjaxClient,f.ReadPage(u,function(n){var u="help.axd?m=DocumentationPage&id="+n.Id;i===SH.HistoryState.Replace?(n.HistoryId=r,history.replaceState(n,n.Title,u)):i===SH.HistoryState.Push?(n.HistoryId=++r,history.pushState(n,n.Title,u)):i===SH.HistoryState.Pop&&(n.HistoryId=r);ft(t);o(n)}))}function e(n){return parseInt(n.substring(11))}function ut(){if(u&&u.CanEdit){var t=it().outerWidth(!0);st().css({left:t+"px"});pt().css({left:t+"px"});it().show();tt().hide();g().hide();nt().hide();v().hide();rt().show();n&&(v().show(),y().prop("disabled",!0).prop("checked",n.IsHidden),n.PageType===SH.PageTypes.PopupPage?(h().prop("disabled",!0).val(n.DocImageUrl||""),tt().show()):n.PageType===SH.PageTypes.DocumentationPage&&g().show())}}function c(){var t,u,i,r,f;n&&(t=p(),u=vt(),n.PageType===SH.PageTypes.PopupPage?(f=s(),i=Math.max(t.get(0).clientHeight,f.height()),r=Math.max(t.get(0).clientWidth,f.width()),u.width(r).height(i),et.$getPopupMask().width(r).height(i)):n.PageType===SH.PageTypes.DocumentationPage&&(i=t.get(0).clientHeight,r=t.get(0).clientWidth,u.width(r).height(i)))}function wt(){if(n){var i=new SH.AjaxClient;i.SavePage(n,function(){var i=t().jstree("get_node","shTocEntry-"+n.Id);n.PageType===SH.PageTypes.PopupPage||n.PageType===SH.PageTypes.DocumentationPage&&t().jstree("rename_node",i,n.Title);n.IsHidden?(i.li_attr["class"]="tocHidden",$("#"+i.id).addClass("tocHidden")):(i.li_attr["class"]="",$("#"+i.id).removeClass("tocHidden"));o(n);$("#shStatusMessage").html("Page saved.").css("background-color","#2d9639").show().delay(1e3).fadeOut("slow")})}}function ft(n){var i=t().jstree(),r=i.get_selected(!0);i.deselect_node(r);i.select_node(n)}function o(t){i.DisableDragging();n=t;b=$.extend(!0,{},t);a().hide();l().hide();s().hide();i.ClosePage();t&&(t.PageType===SH.PageTypes.PopupPage?(s().attr("src",t.DocImageUrl).show(),i.ShowPage(t)):t.PageType===SH.PageTypes.DocumentationPage&&(ct().html(n.Title),ht().html(n.Content),a().show(),l().hide()));ut();c()}function bt(){$("#shStatusMessage").html("Changes canceled.").css("background-color","#3c454f").show().delay(1e3).fadeOut("slow");o(b)}function kt(){rt().hide();nt().show();y().prop("disabled",!1);n.PageType===SH.PageTypes.PopupPage?(h().prop("disabled",!1),i.EnableDragging(p())):n.PageType===SH.PageTypes.DocumentationPage&&(d().val(n.Title),k().val(n.Content),a().hide(),l().show())}function dt(){window.open(SH.Urls.GenerateInstallScript)}function gt(){var n=t().jstree();n.create_node("#",{text:"New Page"},"last",function(t){setTimeout(function(){n.edit(t)},0)})}function ni(){s().attr("src",$(this).val());c()}function ti(n){var i,r,f;if($.each(n,function(n,i){var r='<li id="shTocEntry-'+i.Id+'" class="shTocEntry'+(i.IsHidden?" tocHidden":"")+'">';r+=i.Title;r+="<ul><\/ul><\/li>";i.ParentPageId?$("#shTocEntry-"+i.ParentPageId+">ul").append(r):t().find(">ul").append(r)}),i=["wholerow","state"],r={core:{check_callback:!0,multiple:!1,themes:{icons:!1}},plugins:i},u.CanEdit&&(i.push("contextmenu"),i.push("dnd"),r.contextmenu={items:{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"New Page",action:function(n){var t=$.jstree.reference(n.reference),i=t.get_node(n.reference);t.create_node(i,{text:"New Page"},"last",function(n){setTimeout(function(){t.edit(n)},0)})}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete Page",action:function(n){var i=$.jstree.reference(n.reference),t=i.get_node(n.reference),r,u;$.each(t.children,function(n,r){i.move_node(r,t.parent,"last")});i.delete_node(t);r=e(t.id);u=new SH.AjaxClient;u.DeletePage(r)}}}}),f=t().jstree(r).on("activate_node.jstree",ri).on("ready.jstree",si),u.CanEdit)f.on("create_node.jstree",ui).on("delete_node.jstree",fi).on("move_node.jstree",ei).on("rename_node.jstree",oi)}function ii(){n.IsHidden=y().prop("checked");n.PageType===SH.PageTypes.DocumentationPage?(n.Title=d().val(),n.Content=k().val()):n.PageType===SH.PageTypes.PopupPage&&(n.DocImageUrl=h().val());wt()}function ri(n,t){w(t.node)}function ui(n,t){var i={ParentPageId:e(t.parent),PageType:SH.PageTypes.DocumentationPage,Order:t.position,Title:"New Page",Content:""},r=new SH.AjaxClient;r.SavePage(i,function(n){t.instance.set_id(t.node,"shTocEntry-"+n.Id);f=n})}function fi(n,t){var r=null,u,i;t.node.parent==="#"?(u=$(".shTocEntry"),u.length>0&&(i=u.get(0).id,i===t.node.id&&(i=null,u.length>1&&(i=u.get(1).id)),i&&(r=t.instance.get_node(i)))):t.node.parent&&(r=t.instance.get_node(t.node.parent));r?(t.instance.select_node(r),w(r,SH.HistoryState.Replace)):o(null)}function ei(t,i){var r=e(i.node.id),u=e(i.parent),f=new SH.AjaxClient;f.MovePage(r,u,i.position);n.Id===r&&(n.ParentPageId=u,n.Order=i.position)}function oi(n,t){if(f){f.Title=t.text;var i=new SH.AjaxClient;i.SavePage(f);f=null}}function si(n,i){var r=null,f=SH.Helpers.GetQueryParameter("id"),u;f&&(r=t().jstree("get_node","shTocEntry-"+f));r||(u=i.instance.get_selected(!0),u&&u.length>0&&(r=u[0]));r&&w(r,SH.HistoryState.Replace)}function hi(n){var i=n.state,f=i.HistoryId>r,u;f?r++:r--;u=t().jstree("get_node","shTocEntry-"+i.Id);u?(ft(u),o(i)):f?history.forward():history.back()}var u=null,n=null,et=new SH.SharedElements,f=null,b=null,i=null,r=1;this.Initialize=function(){var t={documentationContainer:p(),anchoredMode:!1,showButtonBar:!1,showDocumentLink:!1},n;i=new SH.PopupView(t);n=new SH.AjaxClient;n.ReadApplicationSettings(function(n){u=n;i.Initialize(n);ut()});n.ReadTableOfContents(ti);h().change(ni);yt().click(ii);ot().click(bt);v().click(kt);lt().click(dt);at().click(gt);$(window).resize(c);window.onpopstate=hi;c()}};SH.HelpButton=function(){function n(){return $(".shHelpButton")}function i(i){t=i;i?n().attr("Title","Show help for this page"):n().attr("Title","View documentation")}function u(){t?$(r).trigger("showPopup.sh"):window.location=SH.Urls.NavigateDocumentation}var r=this,t=null;this.Initialize=function(t,r){i(r);$(t).bind("pageUpdate.sh",function(n,t){i(t)});n().click(u)}};SH.PopupEdit=function(){function ut(){return $("#shAddBulletButton")}function ft(n){return $(".shBulletEdit",n)}function p(){return $("#shBulletEditTemplate")}function w(n){return $(".shBulletEditText",n)}function et(){return $("#shCancelHelpButton")}function i(){return $("#shCreateHelpButton")}function e(){return $(".shDialogTitle")}function b(n){return $(">.shDraggableBullet",n)}function o(n){return $(".shDraggableBulletNumber",n)}function t(){return $("#shPopupEdit")}function r(){return $("#shPopupEditBullets")}function s(){return $("#shPopupEditContent")}function h(){return $("#shPopupEditMatchUrls")}function c(){return $("#shPopupEditTitle")}function l(){return $("#shSaveHelpButton")}function k(n){var t=p().clone(!0,!0).attr("id","shBulletEdit-"+n.Number),i,u,f,e;t.find(".shBulletNumber").html(n.Number);n.Text&&w(t).val(n.Text);r().append(t);i=b(t);o(i).html(n.Number);i.detach();$("body").append(i);n.OffsetElementId?(e=$("#"+n.OffsetElementId).offset(),u=e.top+n.VerticalOffset,f=e.left+n.HorizontalOffset):(u=t.offset().top-3,f=t.offset().left-50);i.attr("id","shDraggableBullet-"+n.Number).css({top:u+"px",left:f+"px"}).draggable({containment:"document",stop:at});nt(i.get(0))}function d(){b("body").remove();t().hide();v.$getPopupMask().hide();i().show()}function ot(){l().html("Create");e().html("Create Help Page");c().val("Help - "+document.title);h().val(window.location.pathname);s().val("");r().empty();var n=$(document).width()/3*2-t().width();t().css({top:"200px",left:n})}function st(n){l().html("Save");e().html("Edit Help Page");c().val(n.Title);h().val(n.MatchUrls);s().val(n.Content);r().empty();$.each(n.Bullets,function(n,t){k(t)});var i=$("#"+n.OffsetElementId),u=i.offset().top+n.VerticalOffset+"px",f=i.offset().left+n.HorizontalOffset+"px";t().css({top:u,left:f})}function g(n){var u=$(n),t=u.offset().left,f=t+u.width(),e=(f-t)/2+t,i=u.offset().top,o=i+u.height(),s=(o-i)/2+i,r=null;return y.each(function(n,u){var f=$(u),o=f.offset().left,l=o+f.width(),a=(l-o)/2+o,h=f.offset().top,v=h+f.height(),y=(v-h)/2+h,c=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(s-y),2));r?c<r.Distance&&(r={Distance:c,HorizontalOffset:Math.round(t-o),VerticalOffset:Math.round(i-h),OffsetElementId:f.attr("id")}):r={Distance:c,HorizontalOffset:Math.round(t-o),VerticalOffset:Math.round(i-h),OffsetElementId:f.attr("id")}}),r}function nt(t){var r=g(t),u=parseInt(o($(t)).html()),i;$.each(n.Bullets,function(n,t){t.Number===u&&(i=t)});i.HorizontalOffset=r.HorizontalOffset;i.VerticalOffset=r.VerticalOffset;i.OffsetElementId=r.OffsetElementId}function tt(t){var i=g(t);n.HorizontalOffset=i.HorizontalOffset;n.VerticalOffset=i.VerticalOffset;n.OffsetElementId=i.OffsetElementId}function a(){var t=window.location.href,i=window.location.host,r=t.substring(t.indexOf(i)+i.length,t.length);n.Id=n.Id||0;n.PageType=n.PageType||SH.PageTypes.PopupPage;n.Title=c().val();n.MatchUrls=h().val();n.SourceUrl=r;n.Content=s().val();$.each(n.Bullets,function(n,t){t.Text=w($("#shBulletEdit-"+(n+1))).val()})}function ht(){var t={Number:n.Bullets.length+1};n.Bullets.push(t);k(t)}function ct(){n=f;d()}function lt(){f&&(f=$.extend(!0,{},n));n?st(n):(n={Bullets:[]},ot());i().hide();v.$getPopupMask().show();var r=t().show();tt(r.get(0))}function at(){nt(this);a()}function vt(){tt(this);a()}function yt(){var t=$(this).closest(".shBulletEdit"),i=t.find(".shBulletNumber").html();t.remove();$("#shDraggableBullet-"+i).remove();ft(r()).each(function(n,t){var i=n+1,r=$(t).find(".shBulletNumber"),f=r.html(),u;r.html(i);$(t).attr("id","shBulletEdit-"+i);u=$("#shDraggableBullet-"+f).attr("id","shDraggableBullet-"+i);o(u).html(i)});n.Bullets.splice(i-1,1);$.each(n.Bullets,function(n,t){t.Number=n+1})}function pt(){a();var t=new SH.AjaxClient;t.SavePage(n,function(t){n.Id=t.Id});i().html("Edit Help Page");d();$(rt).trigger("pageUpdate.sh",n)}function wt(){it.UpdateElementPositions(n,t())}var it=new SH.AnchoredElementLogic,u=null,n=null,v=new SH.SharedElements,y=null,f=null,rt=this;this.Initialize=function(r,f){u=r;n=f;u&&u.CanEdit&&(n&&i().html("Edit Help Page"),i().click(lt),l().click(pt),et().click(ct),ut().click(ht),p().find(".shButtonCancel").click(yt),t().draggable({handle:e(),containment:"document",stop:vt}),y=$("*[id]:visible:not(.sh-,.sh- *,link,meta,script,style,:has(*))"));$(window).resize(wt)}};SH.PopupView=function(n){function k(n){return $(".shBulletNumber",n)}function d(){return $("#shBulletViewTemplate")}function g(n){return $(".shBulletViewText",n)}function nt(){return $("#shPopupView .shButtonBar")}function tt(){return $("#shCloseHelpButton")}function e(){return $(".shDialogTitle")}function it(){return $("#shHideHelpButton")}function a(n){return $(".shPlacedBulletNumber",n)}function o(n){return $(">.shPlacedBullet",n)}function u(){return $("#shPopupView")}function v(){return $("#shPopupViewBullets")}function rt(){return $("#shPopupViewContent")}function y(){return $("#shShowDocumentationButton")}function ut(n){null===r?r={PageId:t.Id,HidePage:n}:r.HidePage=n;var i=new SH.AjaxClient;i.SaveUserPageSettings(r)}function ft(){i.documentationContainer&&s&&s.CanEdit&&t&&t.PageType===SH.PageTypes.PopupPage&&(e().css({cursor:"move"}),u().draggable({handle:e(),containment:i.documentationContainer,stop:st}),o(i.documentationContainer).each(function(n,t){$(t).css({cursor:"move"}).draggable({containment:i.documentationContainer,stop:ot})}),h=!0)}function et(n){var e,s,h,t,r,u;i.anchoredMode?(e=$("body"),t=$("#"+n.OffsetElementId).offset(),s=t?t.top+n.VerticalOffset:0,h=t?t.left+n.HorizontalOffset:f):(e=i.documentationContainer,s=n.DocVerticalOffset||0,h=n.DocHorizontalOffset||f,f+=40);r=d().clone(!0,!0).attr("id","shBulletView-"+n.Number);k(r).html(n.Number);g(r).html(n.Text);v().append(r);u=o(r);a(u).html(n.Number);u.detach();e.append(u);u.attr("id","shPlacedBullet-"+n.Number).css({top:s,left:h})}function p(){var n=i.documentationContainer||$("body");o(n).remove()}function ot(){var i=t.Bullets,n=$(this),r=parseInt(a(n).html());$.each(i,function(t,i){i.Number===r&&(i.DocVerticalOffset=Math.round(n.css("top").replace("px","")),i.DocHorizontalOffset=Math.round(n.css("left").replace("px","")))})}function w(n){n.data.model.ClosePage();var t=new SH.Cookies;t.SetCookie("SH-HideHelp",n.data.hide.toString(),730);ut(n.data.hide)}function st(){t.DocVerticalOffset=Math.round($(this).css("top").replace("px",""));t.DocHorizontalOffset=Math.round($(this).css("left").replace("px",""))}function ht(){i.anchoredMode&&c.UpdateElementPositions(t,u())}var i={documentationContainer:null,anchoredMode:!0,showButtonBar:!0,showDocumentLink:!0};n&&$.extend(i,n);var c=new SH.AnchoredElementLogic,s=null,t=null,h=!1,l=new SH.SharedElements,b=this,r=null,f=0;this.ClosePage=function(){p();u().hide();l.$getPopupMask().hide()};this.DisableDragging=function(){h&&(e().css({cursor:"auto"}),u().draggable("destroy"),o(i.documentationContainer).each(function(n,t){$(t).css({cursor:"auto"}).draggable("destroy")}),h=!1)};this.EnableDragging=function(){ft()};this.Initialize=function(n,r,u){s=n;i.showButtonBar?(tt().click({model:this,hide:!1},w),it().click({model:this,hide:!0},w)):nt().hide();i.showDocumentLink?y().show().click(function(){window.location=SH.Urls.NavigateDocumentation}):y().hide();$(window).resize(ht);$(r).bind("pageUpdate.sh",function(n,i){t=i});$(u).bind("showPopup.sh",function(){b.ShowPage()})};this.ShowPage=function(n){var r,o,s;n&&(t=n);t&&(p(),rt().html(t.Content),e().html(t.Title),r=u(),i.anchoredMode?c.UpdateElementPosition(t,r):(o=n.DocVerticalOffset||40,s=n.DocHorizontalOffset||0,r.show().css({top:o+"px",left:s+"px"})),f=0,v().empty(),$.each(t.Bullets,function(n,t){et(t)}),l.$getPopupMask().show(),r.show())};this.ShowPageFirstTime=function(n,i){r=i;t=n;var u=new SH.Cookies;t&&u.GetCookie("SH-HideHelp")!=="true"&&(r===null||!r.HidePage)&&this.ShowPage()}};SH.SharedElements=function(){this.$getPopupMask=function(){return $("#shPopupMask")}};
//# sourceMappingURL=DocMAHJavaScript.min.js.map
