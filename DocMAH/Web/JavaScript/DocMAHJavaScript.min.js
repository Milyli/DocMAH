var DMH=DMH||{};DMH.PageTypes=function(){return this.FirstTimePage=1,this.DocumentationPage=2,this}();DMH.HistoryState=function(){return this.Replace=1,this.Push=2,this.Pop=3,this}();DMH.Urls=function(){return this.DeletePage="/help.axd?m=DeletePage",this.GenerateInstallScript="/help.axd?m=GenerateInstallScript",this.MovePage="/help.axd?m=MovePage",this.NavigateDocumentation="/help.axd?m=DocumentationPage",this.ReadApplicationSettings="/help.axd?m=ReadApplicationSettings",this.ReadPage="/help.axd?m=ReadPage",this.ReadTableOfContents="/help.axd?m=ReadTableOfContents",this.SavePage="/help.axd?m=SavePage",this.SaveUserPageSettings="/help.axd?m=SaveUserPageSettings",this}();DMH.Helpers=function(){return this.GetQueryParameter=function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))},this}();DMH.AjaxClient=function(){this.DeletePage=function(n,t){$.ajax({type:"POST",url:DMH.Urls.DeletePage,data:n.toString(),success:t})};this.MovePage=function(n,t,i){$.ajax({type:"POST",url:DMH.Urls.MovePage,data:JSON.stringify({PageId:n,NewParentId:t,NewPosition:i}),async:!1})};this.ReadApplicationSettings=function(n){$.ajax({type:"GET",url:DMH.Urls.ReadApplicationSettings,success:n,async:!1})};this.ReadPage=function(n,t){$.ajax({type:"GET",data:{id:n},url:DMH.Urls.ReadPage,success:t})};this.ReadTableOfContents=function(n){$.ajax({type:"GET",url:DMH.Urls.ReadTableOfContents,success:n})};this.SavePage=function(n,t){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:DMH.Urls.SavePage,data:JSON.stringify(n),success:t})};this.SaveUserPageSettings=function(n){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:DMH.Urls.SaveUserPageSettings,data:JSON.stringify(n)})}};DMH.AnchoredElementLogic=function(){var t=new DMH.SharedElements,n=this;this.UpdateElementPosition=function(n,t){if(t.length>0){var r=$("#"+n.OffsetElementId).offset(),u=r?r.top+n.VerticalOffset:0,i=r?r.left+n.HorizontalOffset:0;i<0?i=0:i+t.width()>$(document).width()&&(i=$(document).width()-t.width());t.css({top:u,left:i})}};this.UpdateElementPositions=function(i,r){t.$getModalMask().is(":visible")&&($.each(i.Bullets,function(t,i){n.UpdateElementPosition(i,$("#dmhDraggableBullet-"+i.Number));n.UpdateElementPosition(i,$("#dmhPlacedBullet-"+i.Number))}),r.is(":visible")&&n.UpdateElementPosition(i,r))}};DMH.Cookies=function(){this.DeleteCookie=function(n){document.cookie=n+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"};this.GetCookie=function(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return""};this.SetCookie=function(n,t,i){var r=new Date,u=n+"="+t,f;i&&(r.setTime(r.getTime()+i*864e5),f="expires="+r.toUTCString(),u=u+"; "+f);document.cookie=u}};DMH.DocumentationPage=function(){function ot(){return $("#dmhCancelButton")}function st(){return $("#dmhDocContentPanel")}function l(){return $("#dmhDocumentationEditor")}function k(){return $("#dmhDocumentationEditorContent")}function d(){return $("#dmhDocumentationEditorTitle")}function g(){return $("#dmhDocumentationTools")}function a(){return $("#dmhDocumentationView")}function ht(){return $("#dmhDocumentationViewContent")}function ct(){return $("#dmhDocumentationViewTitle")}function v(){return $("#dmhEditButton")}function nt(){return $("#dmhEditModeButtonBar")}function lt(){return $("#dmhGenerateInstallScriptButton")}function y(){return $("#dmhIsHidden")}function at(){return $("#dmhNewPageButton")}function vt(){return $("#dmhPage")}function p(){return $("#dmhPageContainer")}function s(){return $("#dmhFirstTimeImage")}function h(){return $("#dmhFirstTimeImageUrl")}function tt(){return $("#dmhFirstTimeTools")}function yt(){return $("#dmhSaveButton")}function t(){return $("#dmhToc")}function pt(){return $("#dmhDocTitle")}function it(){return $("#dmhDocToolBar")}function rt(){return $("#dmhViewModeButtonBar")}function w(t,i){var u,f;i=i||DMH.HistoryState.Push;u=e(t.id);u&&(!n||n.Id!==u)&&(f=new DMH.AjaxClient,f.ReadPage(u,function(n){var u="help.axd?m=DocumentationPage&id="+n.Id;i===DMH.HistoryState.Replace?(n.HistoryId=r,history.replaceState(n,n.Title,u)):i===DMH.HistoryState.Push?(n.HistoryId=++r,history.pushState(n,n.Title,u)):i===DMH.HistoryState.Pop&&(n.HistoryId=r);ft(t);o(n)}))}function e(n){return parseInt(n.substring(12))}function ut(){if(u&&u.CanEdit){var t=it().outerWidth(!0);st().css({left:t+"px"});pt().css({left:t+"px"});it().show();tt().hide();g().hide();nt().hide();v().hide();rt().show();n&&(v().show(),y().prop("disabled",!0).prop("checked",n.IsHidden),n.PageType===DMH.PageTypes.FirstTimePage?(h().prop("disabled",!0).val(n.DocImageUrl||""),tt().show()):n.PageType===DMH.PageTypes.DocumentationPage&&g().show())}}function c(){var t,u,i,r,f;n&&(t=p(),u=vt(),n.PageType===DMH.PageTypes.FirstTimePage?(f=s(),i=Math.max(t.get(0).clientHeight,f.height()),r=Math.max(t.get(0).clientWidth,f.width()),u.width(r).height(i),et.$getModalMask().width(r).height(i)):n.PageType===DMH.PageTypes.DocumentationPage&&(i=t.get(0).clientHeight,r=t.get(0).clientWidth,u.width(r).height(i)))}function wt(){if(n){var i=new DMH.AjaxClient;i.SavePage(n,function(){var i=t().jstree("get_node","dmhTocEntry-"+n.Id);n.PageType===DMH.PageTypes.FirstTimePage||n.PageType===DMH.PageTypes.DocumentationPage&&t().jstree("rename_node",i,n.Title);n.IsHidden?(i.li_attr["class"]="tocHidden",$("#"+i.id).addClass("tocHidden")):(i.li_attr["class"]="",$("#"+i.id).removeClass("tocHidden"));o(n);$("#dmhStatusMessage").html("Page saved.").css("background-color","#2d9639").show().delay(1e3).fadeOut("slow")})}}function ft(n){var i=t().jstree(),r=i.get_selected(!0);i.deselect_node(r);i.select_node(n)}function o(t){i.DisableDragging();n=t;b=$.extend(!0,{},t);a().hide();l().hide();s().hide();i.ClosePage();t&&(t.PageType===DMH.PageTypes.FirstTimePage?(s().attr("src",t.DocImageUrl).show(),i.ShowPage(t)):t.PageType===DMH.PageTypes.DocumentationPage&&(ct().html(n.Title),ht().html(n.Content),a().show(),l().hide()));ut();c()}function bt(){$("#dmhStatusMessage").html("Changes canceled.").css("background-color","#3c454f").show().delay(1e3).fadeOut("slow");o(b)}function kt(){rt().hide();nt().show();y().prop("disabled",!1);n.PageType===DMH.PageTypes.FirstTimePage?(h().prop("disabled",!1),i.EnableDragging(p())):n.PageType===DMH.PageTypes.DocumentationPage&&(d().val(n.Title),k().val(n.Content),a().hide(),l().show())}function dt(){window.open(DMH.Urls.GenerateInstallScript)}function gt(){var n=t().jstree();n.create_node("#",{text:"New Page"},"last",function(t){setTimeout(function(){n.edit(t)},0)})}function ni(){s().attr("src",$(this).val());c()}function ti(n){var i,r,f;if($.each(n,function(n,i){var r='<li id="dmhTocEntry-'+i.Id+'" class="dmhTocEntry'+(i.IsHidden?" tocHidden":"")+'">';r+=i.Title;r+="<ul><\/ul><\/li>";i.ParentPageId?$("#dmhTocEntry-"+i.ParentPageId+">ul").append(r):t().find(">ul").append(r)}),i=["wholerow","state"],r={core:{check_callback:!0,multiple:!1,themes:{icons:!1}},plugins:i},u.CanEdit&&(i.push("contextmenu"),i.push("dnd"),r.contextmenu={items:{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"New Page",action:function(n){var t=$.jstree.reference(n.reference),i=t.get_node(n.reference);t.create_node(i,{text:"New Page"},"last",function(n){setTimeout(function(){t.edit(n)},0)})}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete Page",action:function(n){var i=$.jstree.reference(n.reference),t=i.get_node(n.reference),r,u;$.each(t.children,function(n,r){i.move_node(r,t.parent,"last")});i.delete_node(t);r=e(t.id);u=new DMH.AjaxClient;u.DeletePage(r)}}}}),f=t().jstree(r).on("activate_node.jstree",ri).on("ready.jstree",si),u.CanEdit)f.on("create_node.jstree",ui).on("delete_node.jstree",fi).on("move_node.jstree",ei).on("rename_node.jstree",oi)}function ii(){n.IsHidden=y().prop("checked");n.PageType===DMH.PageTypes.DocumentationPage?(n.Title=d().val(),n.Content=k().val()):n.PageType===DMH.PageTypes.FirstTimePage&&(n.DocImageUrl=h().val());wt()}function ri(n,t){w(t.node)}function ui(n,t){var i={ParentPageId:e(t.parent),PageType:DMH.PageTypes.DocumentationPage,Order:t.position,Title:"New Page",Content:""},r=new DMH.AjaxClient;r.SavePage(i,function(n){t.instance.set_id(t.node,"dmhTocEntry-"+n.Id);f=n})}function fi(n,t){var r=null,u,i;t.node.parent==="#"?(u=$(".dmhTocEntry"),u.length>0&&(i=u.get(0).id,i===t.node.id&&(i=null,u.length>1&&(i=u.get(1).id)),i&&(r=t.instance.get_node(i)))):t.node.parent&&(r=t.instance.get_node(t.node.parent));r?(t.instance.select_node(r),w(r,DMH.HistoryState.Replace)):o(null)}function ei(t,i){var r=e(i.node.id),u=e(i.parent),f=new DMH.AjaxClient;f.MovePage(r,u,i.position);n.Id===r&&(n.ParentPageId=u,n.Order=i.position)}function oi(n,t){if(f){f.Title=t.text;var i=new DMH.AjaxClient;i.SavePage(f);f=null}}function si(n,i){var r=null,f=DMH.Helpers.GetQueryParameter("id"),u;f&&(r=t().jstree("get_node","dmhTocEntry-"+f));r||(u=i.instance.get_selected(!0),u&&u.length>0&&(r=u[0]));r&&w(r,DMH.HistoryState.Replace)}function hi(n){var i=n.state,f=i.HistoryId>r,u;f?r++:r--;u=t().jstree("get_node","dmhTocEntry-"+i.Id);u?(ft(u),o(i)):f?history.forward():history.back()}var u=null,n=null,et=new DMH.SharedElements,f=null,b=null,i=null,r=1;this.Initialize=function(){var t={documentationContainer:p(),anchoredMode:!1,showButtonBar:!1,showDocumentLink:!1},n;i=new DMH.FirstTimeView(t);n=new DMH.AjaxClient;n.ReadApplicationSettings(function(n){u=n;i.Initialize(n);ut()});n.ReadTableOfContents(ti);h().change(ni);yt().click(ii);ot().click(bt);v().click(kt);lt().click(dt);at().click(gt);$(window).resize(c);window.onpopstate=hi;c()}};DMH.HelpButton=function(){function n(){return $(".dmhHelpButton")}function i(i){t=i;i?n().attr("Title","Show help for this page"):n().attr("Title","View documentation")}function u(){t?$(r).trigger("showFirstTime.dmh"):window.location=DMH.Urls.NavigateDocumentation}var r=this,t=null;this.Initialize=function(t,r){i(r);$(t).bind("pageUpdate.dmh",function(n,t){i(t)});n().click(u)}};DMH.FirstTimeEdit=function(){function ut(){return $("#dmhAddBulletButton")}function ft(n){return $(".dmhBulletEdit",n)}function p(){return $("#dmhBulletEditTemplate")}function w(n){return $(".dmhBulletEditText",n)}function et(){return $("#dmhCancelHelpButton")}function i(){return $("#dmhCreateHelpButton")}function f(){return $(".dmhDialogTitle")}function b(n){return $(">.dmhDraggableBullet",n)}function e(n){return $(".dmhDraggableBulletNumber",n)}function t(){return $("#dmhFirstTimeEdit")}function r(){return $("#dmhFirstTimeEditBullets")}function o(){return $("#dmhFirstTimeEditContent")}function s(){return $("#dmhFirstTimeEditMatchUrls")}function h(){return $("#dmhFirstTimeEditTitle")}function c(){return $("#dmhSaveHelpButton")}function k(n){var t=p().clone(!0,!0).attr("id","dmhBulletEdit-"+n.Number),i,u,f,o;t.find(".dmhBulletNumber").html(n.Number);n.Text&&w(t).val(n.Text);r().append(t);i=b(t);e(i).html(n.Number);i.detach();$("body").append(i);n.OffsetElementId?(o=$("#"+n.OffsetElementId).offset(),u=o.top+n.VerticalOffset,f=o.left+n.HorizontalOffset):(u=t.offset().top-3,f=t.offset().left-50);i.attr("id","dmhDraggableBullet-"+n.Number).css({top:u+"px",left:f+"px"}).draggable({containment:"document",stop:at});nt(i.get(0))}function d(){b("body").remove();t().hide();a.$getModalMask().hide();i().show()}function ot(){c().html("Create");f().html("Create Help Page");h().val("Help - "+document.title);s().val(window.location.pathname);o().val("");r().empty();var n=$(document).width()/3*2-t().width();t().css({top:"200px",left:n})}function st(n){c().html("Save");f().html("Edit Help Page");h().val(n.Title);s().val(n.MatchUrls);o().val(n.Content);r().empty();$.each(n.Bullets,function(n,t){k(t)});var i=$("#"+n.OffsetElementId),u=i.offset().top+n.VerticalOffset+"px",e=i.offset().left+n.HorizontalOffset+"px";t().css({top:u,left:e})}function g(n){var u=$(n),t=u.offset().left,f=t+u.width(),e=(f-t)/2+t,i=u.offset().top,o=i+u.height(),s=(o-i)/2+i,r=null;return v.each(function(n,u){var f=$(u),o=f.offset().left,l=o+f.width(),a=(l-o)/2+o,h=f.offset().top,v=h+f.height(),y=(v-h)/2+h,c=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(s-y),2));r?c<r.Distance&&(r={Distance:c,HorizontalOffset:Math.round(t-o),VerticalOffset:Math.round(i-h),OffsetElementId:f.attr("id")}):r={Distance:c,HorizontalOffset:Math.round(t-o),VerticalOffset:Math.round(i-h),OffsetElementId:f.attr("id")}}),r}function nt(t){var r=g(t),u=parseInt(e($(t)).html()),i;$.each(n.Bullets,function(n,t){t.Number===u&&(i=t)});i.HorizontalOffset=r.HorizontalOffset;i.VerticalOffset=r.VerticalOffset;i.OffsetElementId=r.OffsetElementId}function tt(t){var i=g(t);n.HorizontalOffset=i.HorizontalOffset;n.VerticalOffset=i.VerticalOffset;n.OffsetElementId=i.OffsetElementId}function l(){var t=window.location.href,i=window.location.host,r=t.substring(t.indexOf(i)+i.length,t.length);n.Id=n.Id||0;n.PageType=n.PageType||DMH.PageTypes.FirstTimePage;n.Title=h().val();n.MatchUrls=s().val();n.SourceUrl=r;n.Content=o().val();$.each(n.Bullets,function(n,t){t.Text=w($("#dmhBulletEdit-"+(n+1))).val()})}function ht(){var t={Number:n.Bullets.length+1};n.Bullets.push(t);k(t)}function ct(){n=y;d()}function lt(){n&&(y=$.extend(!0,{},n));n?st(n):(n={Bullets:[]},ot());i().hide();a.$getModalMask().show();var r=t().show();tt(r.get(0))}function at(){nt(this);l()}function vt(){tt(this);l()}function yt(){var t=$(this).closest(".dmhBulletEdit"),i=t.find(".dmhBulletNumber").html();t.remove();$("#dmhDraggableBullet-"+i).remove();ft(r()).each(function(n,t){var i=n+1,r=$(t).find(".dmhBulletNumber"),f=r.html(),u;r.html(i);$(t).attr("id","dmhBulletEdit-"+i);u=$("#dmhDraggableBullet-"+f).attr("id","dmhDraggableBullet-"+i);e(u).html(i)});n.Bullets.splice(i-1,1);$.each(n.Bullets,function(n,t){t.Number=n+1})}function pt(){l();var t=new DMH.AjaxClient;t.SavePage(n,function(t){n.Id=t.Id});i().html("Edit Help Page");d();$(rt).trigger("pageUpdate.dmh",n)}function wt(){it.UpdateElementPositions(n,t())}var it=new DMH.AnchoredElementLogic,u=null,n=null,a=new DMH.SharedElements,v=null,y=null,rt=this;this.Initialize=function(r,e){u=r;n=e;u&&u.CanEdit&&(n&&i().html("Edit Help Page"),i().click(lt),c().click(pt),et().click(ct),ut().click(ht),p().find(".dmhButtonCancel").click(yt),t().draggable({handle:f(),containment:"document",stop:vt}),v=$("*[id]:visible:not(.dmh-,.dmh- *,link,meta,script,style,:has(*))"));$(window).resize(wt)}};DMH.FirstTimeView=function(n){function k(n){return $(".dmhBulletNumber",n)}function d(){return $("#dmhBulletViewTemplate")}function g(n){return $(".dmhBulletViewText",n)}function nt(){return $("#dmhFirstTimeView .dmhButtonBar")}function tt(){return $("#dmhCloseHelpButton")}function e(){return $(".dmhDialogTitle")}function it(){return $("#dmhHideHelpButton")}function a(n){return $(".dmhPlacedBulletNumber",n)}function o(n){return $(">.dmhPlacedBullet",n)}function u(){return $("#dmhFirstTimeView")}function v(){return $("#dmhFirstTimeViewBullets")}function rt(){return $("#dmhFirstTimeViewContent")}function y(){return $("#dmhShowDocumentationButton")}function ut(n){null===r?r={PageId:t.Id,HidePage:n}:r.HidePage=n;var i=new DMH.AjaxClient;i.SaveUserPageSettings(r)}function ft(){i.documentationContainer&&s&&s.CanEdit&&t&&t.PageType===DMH.PageTypes.FirstTimePage&&(e().css({cursor:"move"}),u().draggable({handle:e(),containment:i.documentationContainer,stop:st}),o(i.documentationContainer).each(function(n,t){$(t).css({cursor:"move"}).draggable({containment:i.documentationContainer,stop:ot})}),h=!0)}function et(n){var e,s,h,t,r,u;i.anchoredMode?(e=$("body"),t=$("#"+n.OffsetElementId).offset(),s=t?t.top+n.VerticalOffset:0,h=t?t.left+n.HorizontalOffset:f):(e=i.documentationContainer,s=n.DocVerticalOffset||0,h=n.DocHorizontalOffset||f,f+=40);r=d().clone(!0,!0).attr("id","dmhBulletView-"+n.Number);k(r).html(n.Number);g(r).html(n.Text);v().append(r);u=o(r);a(u).html(n.Number);u.detach();e.append(u);u.attr("id","dmhPlacedBullet-"+n.Number).css({top:s,left:h})}function p(){var n=i.documentationContainer||$("body");o(n).remove()}function ot(){var i=t.Bullets,n=$(this),r=parseInt(a(n).html());$.each(i,function(t,i){i.Number===r&&(i.DocVerticalOffset=Math.round(n.css("top").replace("px","")),i.DocHorizontalOffset=Math.round(n.css("left").replace("px","")))})}function w(n){n.data.model.ClosePage();var t=new DMH.Cookies;t.SetCookie("DMH-HideHelp",n.data.hide.toString(),730);ut(n.data.hide)}function st(){t.DocVerticalOffset=Math.round($(this).css("top").replace("px",""));t.DocHorizontalOffset=Math.round($(this).css("left").replace("px",""))}function ht(){i.anchoredMode&&c.UpdateElementPositions(t,u())}var i={documentationContainer:null,anchoredMode:!0,showButtonBar:!0,showDocumentLink:!0};n&&$.extend(i,n);var c=new DMH.AnchoredElementLogic,s=null,t=null,h=!1,l=new DMH.SharedElements,b=this,r=null,f=0;this.ClosePage=function(){p();u().hide();l.$getModalMask().hide()};this.DisableDragging=function(){h&&(e().css({cursor:"auto"}),u().draggable("destroy"),o(i.documentationContainer).each(function(n,t){$(t).css({cursor:"auto"}).draggable("destroy")}),h=!1)};this.EnableDragging=function(){ft()};this.Initialize=function(n,r,u){s=n;i.showButtonBar?(tt().click({model:this,hide:!1},w),it().click({model:this,hide:!0},w)):nt().hide();i.showDocumentLink?y().show().click(function(){window.location=DMH.Urls.NavigateDocumentation}):y().hide();$(window).resize(ht);$(r).bind("pageUpdate.dmh",function(n,i){t=i});$(u).bind("showFirstTime.dmh",function(){b.ShowPage()})};this.ShowPage=function(n){var r,o,s;n&&(t=n);t&&(p(),rt().html(t.Content),e().html(t.Title),r=u(),i.anchoredMode?c.UpdateElementPosition(t,r):(o=n.DocVerticalOffset||40,s=n.DocHorizontalOffset||0,r.show().css({top:o+"px",left:s+"px"})),f=0,v().empty(),$.each(t.Bullets,function(n,t){et(t)}),l.$getModalMask().show(),r.show())};this.ShowPageFirstTime=function(n,i){r=i;t=n;var u=new DMH.Cookies;t&&u.GetCookie("DMH-HideHelp")!=="true"&&(r===null||!r.HidePage)&&this.ShowPage()}};DMH.SharedElements=function(){this.$getModalMask=function(){return $("#dmhModalMask")}};
//# sourceMappingURL=DocMAHJavaScript.min.js.map
